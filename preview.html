<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lucky In Love</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;500;600;700&family=Caveat:wght@400;500;600;700&family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --coral: #e8524a;
      --gold: #d4af37;
      --gold-light: #f5e6a3;
      --gold-dark: #b8860b;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Quicksand', sans-serif;
      min-height: 100vh;
      background-image: url('my card.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      color: var(--coral);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    body.editor-open {
      overflow: hidden;
    }

    ::selection {
      background-color: rgba(212, 175, 55, 0.3);
      color: var(--coral);
    }

    .font-cute {
      font-family: 'Pacifico', cursive;
    }

    .font-handwritten {
      font-family: 'Caveat', cursive;
    }

    /* Animations */
    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    @keyframes dustFloat {
      0% { 
        opacity: 1; 
        transform: translate(0, 0) scale(1) rotate(0deg);
      }
      100% { 
        opacity: 0; 
        transform: translate(var(--dx), var(--dy)) scale(0.3) rotate(var(--rot));
      }
    }

    @keyframes glitterFade {
      0% { opacity: 0; transform: translateY(0) scale(0); }
      20% { opacity: 1; transform: translateY(-20px) scale(1); }
      100% { opacity: 0; transform: translateY(-100px) scale(0.5); }
    }

    @keyframes glitterSparkle {
      0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
      50% { opacity: 1; transform: scale(1) rotate(180deg); }
    }

    @keyframes shimmer {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px) rotate(-1deg); }
      75% { transform: translateX(3px) rotate(1deg); }
    }

    @keyframes slideIn {
      0% { transform: translateX(100%); }
      100% { transform: translateX(0); }
    }

    .animate-fadeInUp {
      animation: fadeInUp 0.8s ease-out forwards;
    }

    /* Hero Section */
    .hero {
      position: relative;
      padding: 2rem 1rem 1rem;
      text-align: center;
    }

    .main-title {
      font-size: clamp(2rem, 5vw, 3.5rem);
      color: var(--coral);
      margin-bottom: 0.5rem;
      opacity: 0;
      animation: fadeInUp 0.8s ease-out forwards;
      text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.8);
    }

    .intro-text {
      font-size: 1.2rem;
      color: var(--coral);
      line-height: 1.6;
      opacity: 0;
      animation: fadeInUp 0.8s ease-out 0.2s forwards;
      font-weight: 600;
    }

    /* Edit Mode Button */
    .edit-mode-btn {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 500;
      background: var(--coral);
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 2rem;
      font-family: 'Quicksand', sans-serif;
      font-weight: 600;
      font-size: 0.85rem;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(232, 82, 74, 0.3);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .edit-mode-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(232, 82, 74, 0.4);
    }

    .edit-mode-btn.active {
      background: var(--gold);
    }

    /* Cards Grid */
    .cards-section {
      padding: 1.5rem 1rem 3rem;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }

    @media (min-width: 768px) {
      .cards-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        max-width: 800px;
      }
    }

    /* Individual Scratch Card */
    .scratch-card {
      position: relative;
      aspect-ratio: 1;
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      background: transparent;
    }

    .scratch-card:not(.locked):hover {
      transform: scale(1.08);
      z-index: 10;
    }

    .scratch-card.revealed:hover {
      transform: scale(1.05);
    }

    .scratch-card.locked {
      cursor: not-allowed;
      filter: grayscale(30%);
    }

    .scratch-card.locked:hover {
      animation: shake 0.3s ease-in-out;
    }

    /* Edit button on cards */
    .card-edit-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      z-index: 200;
      background: rgba(255,255,255,0.95);
      color: var(--coral);
      border: 2px solid var(--coral);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 0.9rem;
      cursor: pointer;
      opacity: 0;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    body.edit-mode .card-edit-btn {
      opacity: 1;
    }

    .card-edit-btn:hover {
      background: var(--coral);
      color: white;
      transform: scale(1.1);
    }

    /* Lock overlay */
    .lock-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.3);
      z-index: 30;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .scratch-card.locked .lock-overlay {
      opacity: 1;
    }

    .lock-icon {
      font-size: 2rem;
      margin-bottom: 0.25rem;
    }

    .lock-date {
      font-size: 0.7rem;
      color: white;
      background: rgba(0,0,0,0.5);
      padding: 0.2rem 0.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
    }

    /* Letter underneath - HIDDEN until fully scratched! */
    .letter-layer {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
      opacity: 0;
      transform: scale(0.95);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .scratch-card.revealed .letter-layer {
      opacity: 1;
      transform: scale(1);
    }

    /* Artwork canvas - THIS IS WHAT YOU SCRATCH! */
    .artwork-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      touch-action: none;
    }

    .scratch-card:not(.locked) .artwork-canvas {
      cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28"><circle cx="14" cy="14" r="10" fill="%23e8524a" opacity="0.8"/><circle cx="14" cy="14" r="5" fill="%23fff" opacity="0.9"/></svg>') 14 14, crosshair;
    }

    .scratch-card:not(.locked) .artwork-canvas:active {
      cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="12" fill="%23e8524a"/><circle cx="16" cy="16" r="6" fill="%23fff"/></svg>') 16 16, grabbing;
    }

    .scratch-card.revealed .artwork-canvas {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .scratch-card.revealed .letter-layer {
      cursor: pointer;
    }

    /* Progress indicator */
    .progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--gold), var(--gold-light));
      z-index: 40;
      transition: width 0.1s ease;
      box-shadow: 0 0 8px var(--gold);
    }

    .scratch-card.revealed .progress-bar {
      opacity: 0;
    }

    /* Day label */
    .day-label {
      position: absolute;
      top: -0.5rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--coral);
      color: white;
      font-weight: 700;
      font-size: 0.6rem;
      padding: 0.2rem 0.6rem;
      border-radius: 1rem;
      z-index: 50;
      opacity: 0;
      transition: opacity 0.3s;
      font-family: 'Quicksand', sans-serif;
    }

    .scratch-card:hover .day-label {
      opacity: 1;
    }

    .scratch-card.revealed .day-label {
      opacity: 1;
      background: linear-gradient(135deg, var(--gold), var(--gold-light), var(--gold));
      background-size: 200% auto;
      animation: shimmer 2s linear infinite;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .scratch-card.locked .day-label {
      opacity: 1;
      background: #888;
    }

    /* Scratched badge */
    .scratched-badge {
      position: absolute;
      bottom: -0.5rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--gold);
      color: white;
      font-weight: 700;
      font-size: 0.5rem;
      padding: 0.15rem 0.4rem;
      border-radius: 0.5rem;
      z-index: 50;
      opacity: 0;
      font-family: 'Quicksand', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .scratch-card.revealed .scratched-badge {
      opacity: 1;
    }

    /* Dust particles container */
    .dust-container {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 60;
      overflow: visible;
    }

    .dust {
      position: absolute;
      border-radius: 50%;
      pointer-events: none;
      animation: dustFloat 0.8s ease-out forwards;
    }

    /* Gold Glitter Container */
    .glitter-container {
      position: absolute;
      inset: -50%;
      pointer-events: none;
      z-index: 100;
      overflow: visible;
    }

    .glitter {
      position: absolute;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, var(--gold-light) 0%, var(--gold) 50%, transparent 70%);
      border-radius: 50%;
      animation: glitterFade 1.5s ease-out forwards;
      box-shadow: 0 0 6px var(--gold), 0 0 12px var(--gold-light);
    }

    .glitter-star {
      position: absolute;
      width: 12px;
      height: 12px;
      animation: glitterSparkle 1s ease-out forwards;
    }

    .glitter-star::before,
    .glitter-star::after {
      content: '';
      position: absolute;
      background: linear-gradient(135deg, var(--gold-light), var(--gold));
      border-radius: 2px;
    }

    .glitter-star::before {
      width: 100%;
      height: 3px;
      top: 50%;
      left: 0;
      transform: translateY(-50%);
    }

    .glitter-star::after {
      width: 3px;
      height: 100%;
      left: 50%;
      top: 0;
      transform: translateX(-50%);
    }

    /* FULL PAGE LETTER OVERLAY */
    .letter-overlay {
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease, visibility 0.4s;
      cursor: pointer;
    }

    .letter-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .letter-overlay img {
      max-width: 95%;
      max-height: 95%;
      object-fit: contain;
      border-radius: 1rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.4s ease-out;
    }

    .letter-overlay .close-hint {
      position: absolute;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 0.9rem;
      opacity: 0.7;
      font-family: 'Quicksand', sans-serif;
    }

    /* ========================================
       EDITOR PANEL STYLES
       ======================================== */
    
    .editor-overlay {
      position: fixed;
      inset: 0;
      z-index: 2000;
      background: rgba(0,0,0,0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .editor-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .editor-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      max-width: 500px;
      height: 100%;
      background: #fff;
      z-index: 2001;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      display: flex;
      flex-direction: column;
      box-shadow: -10px 0 30px rgba(0,0,0,0.2);
    }

    .editor-panel.active {
      transform: translateX(0);
    }

    .editor-header {
      padding: 1.5rem;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #fef7f0 0%, #fff 100%);
    }

    .editor-header h2 {
      font-family: 'Pacifico', cursive;
      color: var(--coral);
      font-size: 1.5rem;
      margin: 0;
    }

    .editor-close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #888;
      transition: color 0.2s;
    }

    .editor-close-btn:hover {
      color: var(--coral);
    }

    .editor-content {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .editor-section {
      margin-bottom: 1.5rem;
    }

    .editor-section h3 {
      font-family: 'Quicksand', sans-serif;
      font-weight: 700;
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .editor-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 2px solid #e0e0e0;
      border-radius: 0.5rem;
      font-family: 'Quicksand', sans-serif;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .editor-input:focus {
      border-color: var(--coral);
    }

    .editor-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .file-upload-area {
      border: 2px dashed #e0e0e0;
      border-radius: 0.5rem;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: #fafafa;
    }

    .file-upload-area:hover {
      border-color: var(--coral);
      background: #fef7f0;
    }

    .file-upload-area.has-file {
      border-style: solid;
      border-color: #22c55e;
      background: #f0fdf4;
    }

    .file-upload-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .file-upload-text {
      font-size: 0.9rem;
      color: #666;
    }

    .file-upload-input {
      display: none;
    }

    .image-preview {
      margin-top: 1rem;
      border-radius: 0.5rem;
      overflow: hidden;
      max-height: 150px;
    }

    .image-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .remove-image-btn {
      margin-top: 0.5rem;
      background: #fee2e2;
      border: none;
      color: #dc2626;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      cursor: pointer;
      font-family: 'Quicksand', sans-serif;
      font-size: 0.85rem;
      width: 100%;
    }

    .remove-image-btn:hover {
      background: #fecaca;
    }

    /* Live Preview in Editor */
    .editor-preview {
      background: linear-gradient(135deg, #f5e6d3 0%, #e8d4c0 100%);
      border-radius: 0.75rem;
      padding: 1rem;
      margin-top: 1rem;
    }

    .editor-preview-label {
      font-size: 0.75rem;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
    }

    .preview-card {
      background: linear-gradient(135deg, #c9a96e 0%, #b8956a 50%, #a88555 100%);
      border-radius: 0.5rem;
      padding: 1rem;
      color: white;
      text-align: center;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
    }

    .preview-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      opacity: 0.9;
    }

    .preview-message {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.3rem;
      font-weight: 400;
      line-height: 1.3;
    }

    .preview-image {
      width: 80%;
      max-width: 150px;
      aspect-ratio: 4/3;
      background: white;
      padding: 0.25rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .preview-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .preview-subtitle {
      font-family: 'Caveat', cursive;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .editor-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid #eee;
      background: #fafafa;
    }

    .save-btn {
      width: 100%;
      background: var(--coral);
      color: white;
      border: none;
      padding: 1rem;
      border-radius: 0.5rem;
      font-family: 'Quicksand', sans-serif;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .save-btn:hover {
      background: #d64540;
      transform: scale(1.02);
    }

    .editor-tips {
      margin-top: 1rem;
      padding: 1rem;
      background: #fef3c7;
      border-radius: 0.5rem;
      font-size: 0.8rem;
      color: #92400e;
    }

    .editor-tips strong {
      display: block;
      margin-bottom: 0.5rem;
    }

    .editor-tips ul {
      margin: 0;
      padding-left: 1.25rem;
    }

    .editor-tips li {
      margin-bottom: 0.25rem;
    }

    /* Footer */
    footer {
      padding: 1.5rem 1rem;
      text-align: center;
    }

    .footer-text {
      color: var(--coral);
      font-size: 1.3rem;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- Edit Mode Toggle Button -->
  <button class="edit-mode-btn" id="editModeBtn" onclick="toggleEditMode()">
    <span>‚úèÔ∏è</span> Edit Cards
  </button>

  <!-- Hero Section -->
  <section class="hero">
    <h1 class="main-title font-cute">
      Scratch & Reveal!
    </h1>

    <p class="intro-text font-handwritten">
      6 surprises just for you~
    </p>
  </section>

  <!-- Cards Grid -->
  <section class="cards-section">
    <div class="cards-grid" id="cardsGrid">
      <!-- Cards will be generated by JS -->
    </div>
  </section>

  <!-- Full Page Letter Overlay -->
  <div class="letter-overlay" id="letterOverlay">
    <img src="letter1.jpg" alt="Love Letter" id="overlayImage">
    <span class="close-hint">tap anywhere to close</span>
  </div>

  <!-- Editor Panel Overlay -->
  <div class="editor-overlay" id="editorOverlay" onclick="closeEditor()"></div>
  
  <!-- Editor Panel -->
  <div class="editor-panel" id="editorPanel">
    <div class="editor-header">
      <h2>‚ú® Edit Card <span id="editingDayNumber"></span></h2>
      <button class="editor-close-btn" onclick="closeEditor()">√ó</button>
    </div>
    
    <div class="editor-content">
      <!-- Title -->
      <div class="editor-section">
        <h3>üìù Title (optional)</h3>
        <input 
          type="text" 
          class="editor-input" 
          id="editorTitle" 
          placeholder="e.g., THE LUCKY CHARM"
          oninput="updatePreview()"
        >
      </div>

      <!-- Message -->
      <div class="editor-section">
        <h3>üí¨ Message</h3>
        <textarea 
          class="editor-input editor-textarea" 
          id="editorMessage" 
          placeholder="e.g., I LOVE YOU !!!"
          oninput="updatePreview()"
        ></textarea>
      </div>

      <!-- Photo Upload -->
      <div class="editor-section">
        <h3>üì∑ Photo</h3>
        <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('photoInput').click()">
          <div class="file-upload-icon">üì∑</div>
          <div class="file-upload-text">Click to upload a photo</div>
          <input 
            type="file" 
            id="photoInput" 
            class="file-upload-input" 
            accept="image/*"
            onchange="handlePhotoUpload(event)"
          >
        </div>
        <div class="image-preview" id="imagePreviewContainer" style="display: none;">
          <img id="imagePreview" src="" alt="Preview">
        </div>
        <button class="remove-image-btn" id="removeImageBtn" style="display: none;" onclick="removeImage()">
          ‚úï Remove Photo
        </button>
      </div>

      <!-- Subtitle -->
      <div class="editor-section">
        <h3>‚úçÔ∏è Footer Text (optional)</h3>
        <input 
          type="text" 
          class="editor-input" 
          id="editorSubtitle" 
          placeholder="e.g., Your 2026 fortune..."
          oninput="updatePreview()"
        >
      </div>

      <!-- Live Preview -->
      <div class="editor-section">
        <h3>üëÄ Live Preview</h3>
        <div class="editor-preview">
          <div class="editor-preview-label">This is what your card will look like:</div>
          <div class="preview-card" id="livePreviewCard">
            <div class="preview-title" id="previewTitle"></div>
            <div class="preview-message" id="previewMessage">Your message here</div>
            <div class="preview-image" id="previewImageContainer" style="display: none;">
              <img id="previewImage" src="" alt="Preview">
            </div>
            <div class="preview-subtitle" id="previewSubtitle"></div>
          </div>
        </div>
      </div>

      <!-- Tips -->
      <div class="editor-tips">
        <strong>üí° Tips:</strong>
        <ul>
          <li>Keep your message short and sweet</li>
          <li>Square or landscape photos work best</li>
          <li>Changes save when you click "Save Changes"</li>
        </ul>
      </div>
    </div>

    <div class="editor-footer">
      <button class="save-btn" onclick="saveCardChanges()">
        üíæ Save Changes
      </button>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p class="footer-text font-cute">xoxo</p>
  </footer>

  <script>
    // ============================================
    // CONFIGURATION - EDIT YOUR CARDS HERE!
    // ============================================
    
    const CARDS_DATA = [
      { 
        day: 1, 
        artwork: "artwork1.png", 
        letter: "letter1.jpg", 
        name: "Cowboy Hat", 
        unlockDate: new Date(2025, 0, 7),
        // EDITABLE FIELDS:
        customTitle: "",
        customMessage: "",
        customPhoto: "",
        customSubtitle: ""
      },
      { 
        day: 2, 
        artwork: "artwork2.png", 
        letter: "letter2.jpg", 
        name: "Bandana", 
        unlockDate: new Date(2025, 0, 8),
        customTitle: "",
        customMessage: "",
        customPhoto: "",
        customSubtitle: ""
      },
      { 
        day: 3, 
        artwork: "artwork3.png", 
        letter: "letter3.jpg", 
        name: "Cowgirl", 
        unlockDate: new Date(2025, 0, 9),
        customTitle: "",
        customMessage: "",
        customPhoto: "",
        customSubtitle: ""
      },
      { 
        day: 4, 
        artwork: "artwork4.png", 
        letter: "letter1.jpg", 
        name: "Boots", 
        unlockDate: new Date(2025, 0, 10),
        customTitle: "",
        customMessage: "",
        customPhoto: "",
        customSubtitle: ""
      },
      { 
        day: 5, 
        artwork: "artwork5.png", 
        letter: "letter2.jpg", 
        name: "Pony", 
        unlockDate: new Date(2025, 0, 11),
        customTitle: "",
        customMessage: "",
        customPhoto: "",
        customSubtitle: ""
      },
      { 
        day: 6, 
        artwork: "artwork6.png", 
        letter: "letter3.jpg", 
        name: "Good Luck", 
        unlockDate: new Date(2025, 0, 12),
        customTitle: "",
        customMessage: "",
        customPhoto: "",
        customSubtitle: ""
      },
    ];

    const REVEAL_THRESHOLD = 70;
    const cardStates = {};
    let editingDay = null;
    let isEditMode = false;

    // Dust colors
    const DUST_COLORS = [
      '#ffb6c1', '#ffc0cb', '#ffaeb9', '#ee8282', '#e8524a', '#fff0f5', '#ffe4e1',
    ];

    // ========================================
    // EDITOR FUNCTIONS
    // ========================================

    function toggleEditMode() {
      isEditMode = !isEditMode;
      document.body.classList.toggle('edit-mode', isEditMode);
      document.getElementById('editModeBtn').classList.toggle('active', isEditMode);
      document.getElementById('editModeBtn').innerHTML = isEditMode 
        ? '<span>‚úì</span> Edit Mode ON' 
        : '<span>‚úèÔ∏è</span> Edit Cards';
    }

    function openEditor(day) {
      editingDay = day;
      const card = CARDS_DATA.find(c => c.day === day);
      
      document.getElementById('editingDayNumber').textContent = `Day ${day}`;
      document.getElementById('editorTitle').value = card.customTitle || '';
      document.getElementById('editorMessage').value = card.customMessage || '';
      document.getElementById('editorSubtitle').value = card.customSubtitle || '';
      
      // Handle photo
      if (card.customPhoto) {
        document.getElementById('imagePreview').src = card.customPhoto;
        document.getElementById('imagePreviewContainer').style.display = 'block';
        document.getElementById('removeImageBtn').style.display = 'block';
        document.getElementById('fileUploadArea').classList.add('has-file');
      } else {
        document.getElementById('imagePreviewContainer').style.display = 'none';
        document.getElementById('removeImageBtn').style.display = 'none';
        document.getElementById('fileUploadArea').classList.remove('has-file');
      }
      
      updatePreview();
      
      document.getElementById('editorOverlay').classList.add('active');
      document.getElementById('editorPanel').classList.add('active');
      document.body.classList.add('editor-open');
    }

    function closeEditor() {
      document.getElementById('editorOverlay').classList.remove('active');
      document.getElementById('editorPanel').classList.remove('active');
      document.body.classList.remove('editor-open');
      editingDay = null;
    }

    function handlePhotoUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const dataUrl = e.target.result;
          document.getElementById('imagePreview').src = dataUrl;
          document.getElementById('imagePreviewContainer').style.display = 'block';
          document.getElementById('removeImageBtn').style.display = 'block';
          document.getElementById('fileUploadArea').classList.add('has-file');
          
          // Store temporarily for preview
          if (editingDay) {
            const card = CARDS_DATA.find(c => c.day === editingDay);
            card.customPhoto = dataUrl;
          }
          
          updatePreview();
        };
        reader.readAsDataURL(file);
      }
    }

    function removeImage() {
      document.getElementById('imagePreview').src = '';
      document.getElementById('imagePreviewContainer').style.display = 'none';
      document.getElementById('removeImageBtn').style.display = 'none';
      document.getElementById('fileUploadArea').classList.remove('has-file');
      document.getElementById('photoInput').value = '';
      
      if (editingDay) {
        const card = CARDS_DATA.find(c => c.day === editingDay);
        card.customPhoto = '';
      }
      
      updatePreview();
    }

    function updatePreview() {
      const title = document.getElementById('editorTitle').value;
      const message = document.getElementById('editorMessage').value;
      const subtitle = document.getElementById('editorSubtitle').value;
      const photo = document.getElementById('imagePreview').src;
      
      document.getElementById('previewTitle').textContent = title;
      document.getElementById('previewTitle').style.display = title ? 'block' : 'none';
      
      document.getElementById('previewMessage').textContent = message || 'Your message here';
      
      document.getElementById('previewSubtitle').textContent = subtitle;
      document.getElementById('previewSubtitle').style.display = subtitle ? 'block' : 'none';
      
      if (photo && !photo.endsWith('#')) {
        document.getElementById('previewImage').src = photo;
        document.getElementById('previewImageContainer').style.display = 'block';
      } else {
        document.getElementById('previewImageContainer').style.display = 'none';
      }
    }

    function saveCardChanges() {
      if (!editingDay) return;
      
      const card = CARDS_DATA.find(c => c.day === editingDay);
      card.customTitle = document.getElementById('editorTitle').value;
      card.customMessage = document.getElementById('editorMessage').value;
      card.customSubtitle = document.getElementById('editorSubtitle').value;
      // Photo is already saved on upload
      
      // Save to localStorage for persistence
      saveToLocalStorage();
      
      alert('‚ú® Card saved! Changes will appear when the card is revealed.');
      closeEditor();
    }

    function saveToLocalStorage() {
      const saveData = CARDS_DATA.map(card => ({
        day: card.day,
        customTitle: card.customTitle,
        customMessage: card.customMessage,
        customPhoto: card.customPhoto,
        customSubtitle: card.customSubtitle
      }));
      localStorage.setItem('scratchCardsData', JSON.stringify(saveData));
    }

    function loadFromLocalStorage() {
      const saved = localStorage.getItem('scratchCardsData');
      if (saved) {
        const saveData = JSON.parse(saved);
        saveData.forEach(savedCard => {
          const card = CARDS_DATA.find(c => c.day === savedCard.day);
          if (card) {
            card.customTitle = savedCard.customTitle || '';
            card.customMessage = savedCard.customMessage || '';
            card.customPhoto = savedCard.customPhoto || '';
            card.customSubtitle = savedCard.customSubtitle || '';
          }
        });
      }
    }

    // ========================================
    // SCRATCH CARD FUNCTIONS
    // ========================================

    function isUnlocked(unlockDate) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const unlock = new Date(unlockDate);
      unlock.setHours(0, 0, 0, 0);
      return today >= unlock;
    }

    function formatDate(date) {
      const options = { month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    async function init() {
      // Load any saved customizations
      loadFromLocalStorage();
      
      const grid = document.getElementById('cardsGrid');
      
      for (const card of CARDS_DATA) {
        const unlocked = isUnlocked(card.unlockDate);
        
        cardStates[card.day] = {
          revealed: false,
          progress: 0,
          isScratching: false,
          locked: !unlocked
        };
        
        const cardEl = createCard(card, unlocked);
        grid.appendChild(cardEl);
        await setupScratchCard(cardEl, card, unlocked);
      }

      document.getElementById('letterOverlay').addEventListener('click', closeOverlay);
    }

    function createCard(card, unlocked) {
      const cardEl = document.createElement('div');
      cardEl.className = 'scratch-card' + (unlocked ? '' : ' locked');
      cardEl.dataset.day = card.day;
      cardEl.style.opacity = '0';
      cardEl.style.animation = `fadeInUp 0.6s ease-out ${card.day * 0.1}s forwards`;
      
      cardEl.innerHTML = `
        <button class="card-edit-btn" onclick="event.stopPropagation(); openEditor(${card.day})">‚úèÔ∏è</button>
        <span class="day-label">Day ${card.day}</span>
        <span class="scratched-badge">Revealed!</span>
        <img src="${card.letter}" alt="Love Letter" class="letter-layer" onclick="openOverlay(${card.day})">
        <canvas class="artwork-canvas" data-day="${card.day}"></canvas>
        <div class="progress-bar" style="width: 0%"></div>
        <div class="dust-container"></div>
        <div class="lock-overlay">
          <span class="lock-icon">üîí</span>
          <span class="lock-date">Opens ${formatDate(card.unlockDate)}</span>
        </div>
        <div class="glitter-container"></div>
      `;
      
      return cardEl;
    }

    async function setupScratchCard(cardEl, cardData, unlocked) {
      const canvas = cardEl.querySelector('.artwork-canvas');
      const ctx = canvas.getContext('2d');
      const dustContainer = cardEl.querySelector('.dust-container');
      const progressBar = cardEl.querySelector('.progress-bar');
      
      await new Promise(resolve => setTimeout(resolve, 100));
      
      const rect = cardEl.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      canvas.style.width = rect.width + 'px';
      canvas.style.height = rect.height + 'px';
      ctx.scale(dpr, dpr);
      
      const img = new Image();
      img.onload = () => {
        ctx.clearRect(0, 0, rect.width, rect.height);
        const imgAspect = img.width / img.height;
        const canvasAspect = rect.width / rect.height;
        let drawWidth, drawHeight, drawX, drawY;
        if (imgAspect > canvasAspect) {
          drawHeight = rect.height;
          drawWidth = rect.height * imgAspect;
        } else {
          drawWidth = rect.width;
          drawHeight = rect.width / imgAspect;
        }
        drawX = (rect.width - drawWidth) / 2;
        drawY = (rect.height - drawHeight) / 2;
        ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
      };
      img.src = cardData.artwork;
      
      if (!unlocked) return;
      
      let lastX = null;
      let lastY = null;
      let moveCount = 0;
      
      function getPos(e) {
        const canvasRect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - canvasRect.left, y: clientY - canvasRect.top };
      }
      
      function createDustParticle(x, y) {
        const dust = document.createElement('div');
        dust.className = 'dust';
        const angle = Math.random() * Math.PI * 2;
        const distance = 15 + Math.random() * 30;
        const dx = Math.cos(angle) * distance;
        const dy = Math.sin(angle) * distance - 15;
        dust.style.setProperty('--dx', dx + 'px');
        dust.style.setProperty('--dy', dy + 'px');
        dust.style.setProperty('--rot', (Math.random() * 360) + 'deg');
        dust.style.left = x + 'px';
        dust.style.top = y + 'px';
        dust.style.backgroundColor = DUST_COLORS[Math.floor(Math.random() * DUST_COLORS.length)];
        const size = 2 + Math.random() * 4;
        dust.style.width = size + 'px';
        dust.style.height = size + 'px';
        dustContainer.appendChild(dust);
        setTimeout(() => dust.remove(), 800);
      }
      
      function startScratch(e) {
        if (cardStates[cardData.day].revealed || cardStates[cardData.day].locked) return;
        e.preventDefault();
        cardStates[cardData.day].isScratching = true;
        cardEl.classList.add('scratching');
        const pos = getPos(e);
        lastX = pos.x;
        lastY = pos.y;
        moveCount = 0;
      }
      
      function doScratch(e) {
        if (!cardStates[cardData.day].isScratching) return;
        if (cardStates[cardData.day].revealed) return;
        e.preventDefault();
        const pos = getPos(e);
        if (lastX !== null && lastY !== null) {
          const distance = Math.sqrt((pos.x - lastX) ** 2 + (pos.y - lastY) ** 2);
          if (distance > 2) {
            scratch(pos.x, pos.y, lastX, lastY);
            moveCount++;
            if (moveCount % 3 === 0) {
              createDustParticle(pos.x, pos.y);
            }
          }
        }
        lastX = pos.x;
        lastY = pos.y;
      }
      
      function endScratch() {
        cardStates[cardData.day].isScratching = false;
        cardEl.classList.remove('scratching');
        lastX = null;
        lastY = null;
      }
      
      function scratch(x, y, prevX, prevY) {
        ctx.globalCompositeOperation = 'destination-out';
        const brushSize = Math.min(rect.width, rect.height) * 0.08;
        ctx.lineWidth = brushSize;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.strokeStyle = 'rgba(255,255,255,1)';
        ctx.beginPath();
        ctx.moveTo(prevX, prevY);
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(x, y, brushSize / 2, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalCompositeOperation = 'source-over';
        updateProgress(cardEl, cardData);
      }
      
      canvas.addEventListener('mousedown', startScratch);
      canvas.addEventListener('mousemove', doScratch);
      canvas.addEventListener('mouseup', endScratch);
      canvas.addEventListener('mouseleave', endScratch);
      canvas.addEventListener('touchstart', startScratch, { passive: false });
      canvas.addEventListener('touchmove', doScratch, { passive: false });
      canvas.addEventListener('touchend', endScratch);
    }

    function updateProgress(cardEl, cardData) {
      const canvas = cardEl.querySelector('.artwork-canvas');
      const ctx = canvas.getContext('2d');
      const progressBar = cardEl.querySelector('.progress-bar');
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const pixels = imageData.data;
      let transparentPixels = 0;
      for (let i = 3; i < pixels.length; i += 4) {
        if (pixels[i] < 128) transparentPixels++;
      }
      const totalPixels = pixels.length / 4;
      const progress = Math.round((transparentPixels / totalPixels) * 100);
      cardStates[cardData.day].progress = progress;
      progressBar.style.width = Math.min(progress, 100) + '%';
      if (progress >= REVEAL_THRESHOLD && !cardStates[cardData.day].revealed) {
        revealCard(cardEl, cardData);
      }
    }

    function revealCard(cardEl, cardData) {
      cardStates[cardData.day].revealed = true;
      cardEl.classList.add('revealed');
      const dustContainer = cardEl.querySelector('.dust-container');
      const rect = cardEl.getBoundingClientRect();
      for (let i = 0; i < 40; i++) {
        setTimeout(() => {
          const x = Math.random() * rect.width;
          const y = Math.random() * rect.height;
          const dust = document.createElement('div');
          dust.className = 'dust';
          const angle = Math.random() * Math.PI * 2;
          const distance = 40 + Math.random() * 80;
          const dx = Math.cos(angle) * distance;
          const dy = Math.sin(angle) * distance - 40;
          dust.style.setProperty('--dx', dx + 'px');
          dust.style.setProperty('--dy', dy + 'px');
          dust.style.setProperty('--rot', (Math.random() * 720) + 'deg');
          dust.style.left = x + 'px';
          dust.style.top = y + 'px';
          dust.style.backgroundColor = DUST_COLORS[Math.floor(Math.random() * DUST_COLORS.length)];
          const size = 3 + Math.random() * 6;
          dust.style.width = size + 'px';
          dust.style.height = size + 'px';
          dustContainer.appendChild(dust);
          setTimeout(() => dust.remove(), 1000);
        }, i * 15);
      }
      showGoldGlitter(cardEl);
      setTimeout(() => openOverlay(cardData.day), 1200);
    }

    function openOverlay(day) {
      if (!cardStates[day].revealed) return;
      const cardData = CARDS_DATA.find(c => c.day === day);
      if (cardData) {
        document.getElementById('overlayImage').src = cardData.letter;
      }
      document.getElementById('letterOverlay').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeOverlay() {
      document.getElementById('letterOverlay').classList.remove('active');
      document.body.style.overflow = '';
    }

    function showGoldGlitter(cardEl) {
      const container = cardEl.querySelector('.glitter-container');
      for (let wave = 0; wave < 3; wave++) {
        setTimeout(() => {
          for (let i = 0; i < 20; i++) {
            const glitter = document.createElement('div');
            glitter.className = 'glitter';
            const angle = Math.random() * Math.PI * 2;
            const distance = 30 + Math.random() * 70;
            glitter.style.left = (50 + Math.cos(angle) * distance) + '%';
            glitter.style.top = (50 + Math.sin(angle) * distance) + '%';
            glitter.style.animationDelay = Math.random() * 0.3 + 's';
            glitter.style.animationDuration = (1 + Math.random() * 0.5) + 's';
            const size = 4 + Math.random() * 10;
            glitter.style.width = size + 'px';
            glitter.style.height = size + 'px';
            container.appendChild(glitter);
            setTimeout(() => glitter.remove(), 2500);
          }
          for (let i = 0; i < 8; i++) {
            const star = document.createElement('div');
            star.className = 'glitter-star';
            star.style.left = (10 + Math.random() * 80) + '%';
            star.style.top = (10 + Math.random() * 80) + '%';
            star.style.animationDelay = Math.random() * 0.5 + 's';
            const size = 10 + Math.random() * 10;
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            container.appendChild(star);
            setTimeout(() => star.remove(), 1500);
          }
        }, wave * 250);
      }
    }

    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        document.querySelectorAll('.scratch-card:not(.revealed)').forEach(cardEl => {
          const day = parseInt(cardEl.dataset.day);
          const cardData = CARDS_DATA.find(c => c.day === day);
          if (cardData && !cardStates[day].locked) {
            setupScratchCard(cardEl, cardData, true);
          }
        });
      }, 250);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeOverlay();
        closeEditor();
      }
    });

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
